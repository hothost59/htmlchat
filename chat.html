<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Discord-like Chat â€” Polished</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
:root {
  --bg:#36393f; --panel:#2f3136; --muted:#b9bbbe; --accent:#7289da;
  --card:#4f545c; --card-hover:#5b616b; --sidebar-grad:linear-gradient(to bottom,#2f3136,#202225);
  --text:#e6e6e6;
}
.light {
  --bg:#f4f6f8; --panel:#ffffff; --muted:#6b7280; --accent:#4f46e5;
  --card:#f3f4f6; --text:#111827; --sidebar-grad:linear-gradient(to bottom,#ffffff,#f1f5f9);
}
html,body {
  height:100%; margin:0; font-family:"Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
  color:var(--text);
}
body {
  background:var(--bg); display:flex; align-items:stretch; overflow:hidden;
}
#authDiv {position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:40}
.authCard {width:360px; background:linear-gradient(135deg,var(--panel),#202225); border-radius:14px; padding:22px;
  box-shadow:0 14px 40px rgba(0,0,0,0.6); display:flex; flex-direction:column; gap:12px;}
.authTabs {display:flex; gap:8px;}
.authTabs button {flex:1; padding:10px; border-radius:10px; border:none; cursor:pointer;
  background:var(--accent); color:white; font-weight:600; transition:all .18s;}
.authTabs button.active {opacity:0.9}
.authCard input {width:100%; padding:12px; border-radius:10px; border:none; background:#202225; color:var(--text);}
#submitBtn {padding:12px; border-radius:10px; border:none; background:var(--accent); color:white; font-weight:700; cursor:pointer;}
#app {display:none; width:100%; height:100vh; display:flex; gap:0; align-items:stretch;}
#sidebar {width:300px; background:var(--sidebar-grad); padding:14px; display:flex; flex-direction:column;
  box-shadow:2px 0 18px rgba(0,0,0,0.35); gap:10px;}
#sidebarHeader {font-weight:800; font-size:18px; display:flex; align-items:center; justify-content:space-between;}
#sidebarHeader .controls {display:flex; gap:8px; align-items:center;}
.tinyBtn {background:transparent; border:1px solid rgba(255,255,255,0.06); padding:6px 8px; border-radius:8px; color:var(--text); cursor:pointer;}
.tinyBtn:hover {transform:translateY(-2px)}
#channelList {flex:1; overflow:auto; display:flex; flex-direction:column; gap:8px; padding-right:4px;}
.channelRow {display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 10px;
  border-radius:10px; background:#99aab5; color:black; font-weight:700; cursor:pointer; transition:all .18s;}
.channelRow:hover {transform:scale(1.02); background:var(--accent); color:white;}
.channelRow.active {background:var(--accent); color:white; transform:scale(1.02);}
.channelLeft {display:flex; gap:8px; align-items:center;}
.badge {background:#ff5b5b; color:white; border-radius:999px; padding:2px 8px; font-size:12px; font-weight:700;}
.sidebarButtons {display:flex; gap:8px; margin-top:10px;}
.sidebarButtons button {flex:1; padding:10px; border-radius:10px; border:none; background:var(--accent); color:white; font-weight:700; cursor:pointer;}
#main {flex:1; display:flex; flex-direction:column; background:var(--bg); min-width:0;}
#chatHeader {padding:12px 16px; background:var(--panel); border-bottom:1px solid rgba(255,255,255,0.03);
  font-weight:800; display:flex; justify-content:space-between; align-items:center;}
#chatHeader .meta {display:flex; gap:10px; align-items:center; color:var(--muted); font-weight:600; font-size:13px;}
#messages {flex:1; padding:14px; overflow:auto; display:flex; flex-direction:column; gap:8px;}
.message {display:flex; gap:12px; align-items:flex-start; max-width:980px; transition:all .28s; opacity:0; transform:translateY(10px);}
.message.show {opacity:1; transform:translateY(0);}
.avatar {width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:white;background:#6b6f75;flex:0 0 40px;}
.msgBody {background:var(--card); padding:8px 12px; border-radius:10px; min-width:0;}
.msgHeader {font-weight:700; font-size:14px; display:flex; gap:8px; align-items:center;}
.timestamp {color:var(--muted); font-size:12px; font-weight:600;}
.msgText {margin-top:4px; color:var(--text); white-space:pre-wrap; word-break:break-word;}
.message.system .msgBody {background:var(--accent); color:white; font-weight:700;}
.grouped .avatar, .grouped .msgHeader .username { visibility:hidden; width:0; margin-right:0; }
.compact .msgBody {padding:6px 8px; border-radius:8px;}
.compact .avatar {width:32px;height:32px; flex:0 0 32px;}
#typingBar {height:26px; padding:6px 16px; color:var(--muted); font-weight:700; font-size:13px; display:flex; align-items:center; gap:8px; transition:all .2s; opacity:0;}
#typingBar.show {opacity:1;}
#rightbar {width:260px; background:var(--panel); padding:12px 10px; display:flex; flex-direction:column; gap:10px; box-shadow:-2px 0 18px rgba(0,0,0,0.18);}
#usersHeader {display:flex; justify-content:space-between; align-items:center; font-weight:800;}
.userRow {display:flex; gap:10px; align-items:center; padding:6px; border-radius:8px; cursor:default;}
.userRow:hover {background:rgba(255,255,255,0.02)}
.statusDot {width:10px;height:10px;border-radius:50%;}
.status-online {background:#2ecc71}
.status-away {background:#f1c40f}
.status-offline {background:#95a5a6}
.userName {font-weight:700}
#bottomBar {display:flex; gap:12px; padding:12px; background:var(--sidebar-grad); align-items:center;}
#msgInput {flex:1; padding:12px 14px; border-radius:12px; border:none; background:#202225; color:var(--text); font-size:15px;}
#sendBtn {padding:12px 16px; border-radius:12px; border:none; background:var(--accent); color:white; font-weight:800; cursor:pointer;}
#sendBtn:hover {transform:translateY(-2px)}
#scrollBtn {position:fixed; right:26px; bottom:96px; padding:10px 12px; border-radius:12px; border:none; background:var(--accent); color:white; cursor:pointer; opacity:0; transition:opacity .25s, transform .18s;}
#scrollBtn.show {opacity:1; transform:translateY(0);}
#scrollBtn:hover {transform:translateY(-3px);}
#modalOverlay {position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:50;}
.modalCard {background:var(--panel); padding:18px; border-radius:12px; width:340px; display:flex; flex-direction:column; gap:10px;}
.modalCard input {padding:10px; border-radius:8px; border:none; background:#202225; color:white;}
.modalActions {display:flex; gap:8px; justify-content:flex-end;}
.modalActions button {padding:8px 12px; border-radius:8px; border:none; background:var(--accent); color:white;}
.contextMenu {position:absolute; background:var(--panel); border-radius:8px; padding:6px 0; box-shadow:0 4px 12px rgba(0,0,0,0.3); display:none; z-index:100;}
.contextMenu div {padding:6px 16px; cursor:pointer;}
.contextMenu div:hover {background:var(--accent); color:white;}
@media (max-width:1000px){#rightbar{display:none} #sidebar{width:220px}}
</style>
</head>
<body>

<!-- Authentication -->
<div id="authDiv">
  <div class="authCard">
    <div style="display:flex; align-items:center; justify-content:space-between;">
      <div class="authTabs" role="tablist">
        <button id="loginTab" class="active" onclick="switchAuth('login')">Login</button>
        <button id="signupTab" onclick="switchAuth('signup')">Sign Up</button>
      </div>
      <div style="display:flex; gap:8px;">
        <button class="tinyBtn" id="themeBtn" title="Toggle theme" onclick="toggleTheme()">ðŸŒ™</button>
        <button class="tinyBtn" id="viewBtn" title="Toggle compact/cozy" onclick="toggleView()">ðŸŒ“</button>
      </div>
    </div>
    <input id="authUsername" placeholder="Username" />
    <input id="authPassword" placeholder="Password" type="password" />
    <input id="authConfirm" placeholder="Confirm Password" type="password" style="display:none" />
    <button id="submitBtn" onclick="submitAuth()">Login</button>
    <div id="authMsg" style="color:#ff5b5b;font-weight:700;"></div>
  </div>
</div>

<!-- Main App -->
<div id="app">
  <div id="sidebar">
    <div id="sidebarHeader">#Channels</div>
    <div id="channelList"></div>
    <div class="sidebarButtons">
      <button onclick="createChannel()">+ Channel</button>
      <button onclick="createDMModal()">+ DM</button>
    </div>
  </div>

  <div id="main">
    <div id="chatHeader"><span id="currentChannelName">#general</span></div>
    <div id="messages"></div>
    <div id="typingBar"></div>
    <div id="bottomBar">
      <input id="msgInput" placeholder="Message #general" />
      <button id="sendBtn" onclick="sendMessage()">Send</button>
    </div>
  </div>

  <div id="rightbar">
    <div id="usersHeader">Users</div>
    <div id="userList"></div>
  </div>
</div>

<!-- Modal -->
<div id="modalOverlay">
  <div class="modalCard" id="modalContent">
    <div id="modalText"></div>
    <input id="modalInput" />
    <div class="modalActions">
      <button onclick="modalConfirm()">Confirm</button>
      <button onclick="modalCancel()">Cancel</button>
    </div>
  </div>
</div>

<!-- Context Menu -->
<div id="contextMenu" class="contextMenu"></div>

<!-- Firebase Config Placeholder -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  // Paste your Firebase config here
  const firebaseConfig = {
  apiKey: "AIzaSyACzRg2OM7jX6bgombJodw8-AzUYZfJ7dU",
  authDomain: "discordchat-3ef8f.firebaseapp.com",
  databaseURL: "https://discordchat-3ef8f-default-rtdb.firebaseio.com",
  projectId: "discordchat-3ef8f",
  storageBucket: "discordchat-3ef8f.firebasestorage.app",
  messagingSenderId: "107138375373",
  appId: "1:107138375373:web:019651924ac3fb33a99384"
};
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
</script>

<script>
/* Expanded JS Functions for Readability and Right-Click Context Menus */

let currentUser = null;
let users = [];
let channels = [{id:'general', name:'general', type:'channel', members:[]}];
let messages = {'general':[]};
let currentChannel = 'general';
let compactView = false;
let darkTheme = true;

/* THEMES */
function toggleTheme() {
  darkTheme = !darkTheme;
  if (darkTheme) {
    document.body.classList.remove('light');
  } else {
    document.body.classList.add('light');
  }
}

function toggleView() {
  compactView = !compactView;
  if (compactView) {
    document.body.classList.add('compact');
  } else {
    document.body.classList.remove('compact');
  }
}

/* AUTH */
function switchAuth(mode) {
  document.getElementById('loginTab').classList.toggle('active', mode==='login');
  document.getElementById('signupTab').classList.toggle('active', mode==='signup');
  document.getElementById('authConfirm').style.display = mode==='signup' ? 'block' : 'none';
  document.getElementById('submitBtn').innerText = mode==='login' ? 'Login' : 'Sign Up';
}

function submitAuth() {
  let username = document.getElementById('authUsername').value.trim();
  let password = document.getElementById('authPassword').value.trim();
  if (!username || !password) return alert('Fill all fields');

  let mode = document.getElementById('submitBtn').innerText.toLowerCase();

  if (mode === 'login') {
    let foundUser = users.find(u => u.username === username && u.password === password);
    if (!foundUser) {
      document.getElementById('authMsg').innerText = 'Invalid credentials';
      return;
    }
    currentUser = foundUser;
  } else { // signup
    let confirmPass = document.getElementById('authConfirm').value.trim();
    if (password !== confirmPass) {
      document.getElementById('authMsg').innerText = 'Passwords do not match';
      return;
    }
    if (users.find(u => u.username === username)) {
      document.getElementById('authMsg').innerText = 'Username exists';
      return;
    }
    currentUser = {username, password};
    users.push(currentUser);
  }

  document.getElementById('authDiv').style.display = 'none';
  document.getElementById('app').style.display = 'flex';

  renderUsers();
  renderChannels();
  renderMessages();
}

/* CHANNELS */
function renderChannels() {
  let html = '';
  channels.forEach(c => {
    let activeClass = (c.id === currentChannel) ? ' active' : '';
    let label = (c.type === 'dm') ? ('@' + c.members.find(u => u !== currentUser.username)) : ('#' + c.name);
    html += `<div class="channelRow${activeClass}" onclick="joinChannel('${c.id}')"
      oncontextmenu="channelRightClick(event,'${c.id}')">${label}</div>`;
  });
  document.getElementById('channelList').innerHTML = html;
  updatePlaceholder();
}

function joinChannel(id) {
  currentChannel = id;
  let ch = channels.find(c => c.id === id);
  document.getElementById('currentChannelName').innerText =
    ch.type === 'dm' ? ('@' + ch.members.find(u => u !== currentUser.username)) : ('#' + ch.name);
  updatePlaceholder();
  renderMessages();
}

function updatePlaceholder() {
  let ch = channels.find(c => c.id === currentChannel);
  let name = ch.type==='dm' ? ('@' + ch.members.find(u => u!==currentUser.username)) : ('#'+ch.name);
  document.getElementById('msgInput').placeholder = 'Message ' + name;
}

/* MESSAGES */
function renderMessages() {
  let msgDiv = document.getElementById('messages');
  msgDiv.innerHTML = '';

  if (!messages[currentChannel]) messages[currentChannel] = [];

  messages[currentChannel].forEach(m => {
    let msgElement = document.createElement('div');
    msgElement.className = 'message show';
    if (m.type === 'system') msgElement.classList.add('system');

    msgElement.innerHTML = `
      <div class="avatar">${m.user[0].toUpperCase()}</div>
      <div class="msgBody">
        <div class="msgHeader">
          <span class="username">${m.user}</span>
          <span class="timestamp">${m.timestamp || ''}</span>
        </div>
        <div class="msgText">${m.text}</div>
      </div>
    `;
    msgDiv.appendChild(msgElement);
  });

  msgDiv.scrollTop = msgDiv.scrollHeight;
}

function sendMessage() {
  let input = document.getElementById('msgInput');
  let text = input.value.trim();
  if (!text) return;

  appendMessage(currentUser.username, text);
  input.value = '';
}

function appendMessage(user, text, type='user') {
  if (!messages[currentChannel]) messages[currentChannel] = [];
  messages[currentChannel].push({user, text, type, timestamp: new Date().toLocaleTimeString()});
  renderMessages();
}

/* USERS */
function renderUsers() {
  let html = '';
  users.forEach(u => {
    html += `<div class="userRow" onclick="userClick('${u.username}')"
      oncontextmenu="userRightClick(event,'${u.username}')">
      <div class="avatar">${u.username[0].toUpperCase()}</div>
      <span class="userName">${u.username}</span>
    </div>`;
  });
  document.getElementById('userList').innerHTML = html;
}

function userClick(username) {
  modalPrompt('User options for ' + username + ' (dm/kick/ban/delete):', option => {
    if (!option) return;
    option = option.toLowerCase();

    if (option === 'dm') {
      createDM(username);
    } else if (option === 'kick' || option === 'ban' || option === 'delete') {
      if (currentUser.username !== 'admin') { alert('Only admin can perform this'); return; }
      deleteUser(username);
    }
  });
}

/* CREATE DM */
function createDM(otherUser) {
  let existing = channels.find(c => c.type === 'dm' && c.members.includes(otherUser) && c.members.includes(currentUser.username));
  if (existing) {
    joinChannel(existing.id);
    return;
  }

  let id = 'dm-' + Math.random().toString(36).substring(2,10);
  let dm = {id, type:'dm', members:[currentUser.username, otherUser]};
  channels.push(dm);
  messages[id] = [];
  joinChannel(id);
  renderChannels();
}

/* CREATE CHANNEL/DM */
function createChannel() {
  modalPrompt('Enter channel name:', name => {
    if (!name) return;

    let id = name.toLowerCase().replace(/\s+/g,'-');
    channels.push({id, name, type:'channel', members:[]});
    messages[id] = [];
    renderChannels();
  });
}

function createDMModal() {
  let names = users.filter(u => u.username !== currentUser.username).map(u => u.username).join(', ');
  modalPrompt('Enter user to DM (' + names + '):', name => {
    if (!name) return;

    let user = users.find(u => u.username === name);
    if (!user) { alert('User not found'); return; }

    createDM(user.username);
  });
}

/* DELETE USER */
function deleteUser(username) {
  users = users.filter(u => u.username !== username);
  channels = channels.filter(c => !(c.type === 'dm' && c.members.includes(username)));

  for (let ch in messages) {
    if (!channels.find(c => c.id === ch)) delete messages[ch];
  }

  renderUsers();
  renderChannels();
  renderMessages();
}

/* MODAL HELPERS */
let modalCallback = null;

function modalPrompt(text, callback) {
  document.getElementById('modalText').innerText = text;
  document.getElementById('modalOverlay').style.display = 'flex';
  document.getElementById('modalInput').value = '';
  modalCallback = callback;
}

function modalConfirm() {
  if (modalCallback) modalCallback(document.getElementById('modalInput').value);
  document.getElementById('modalOverlay').style.display = 'none';
}

function modalCancel() {
  document.getElementById('modalOverlay').style.display = 'none';
}

/* RIGHT-CLICK CONTEXT MENUS */
let contextMenu = document.getElementById('contextMenu');

function showContextMenu(items, x, y) {
  contextMenu.innerHTML = '';
  items.forEach(item => {
    let div = document.createElement('div');
    div.innerText = item.label;
    div.onclick = () => { item.action(); contextMenu.style.display = 'none'; };
    contextMenu.appendChild(div);
  });

  contextMenu.style.display = 'block';
  contextMenu.style.left = x + 'px';
  contextMenu.style.top = y + 'px';
}

document.addEventListener('click', () => { contextMenu.style.display = 'none'; });

function channelRightClick(e, channelId) {
  e.preventDefault();
  let ch = channels.find(c => c.id === channelId);

  let items = [
    {label:'Join', action:()=>joinChannel(channelId)}
  ];

  if (currentUser.username === 'admin') {
    items.push(
      {label:'Rename', action:()=>modalPrompt('New channel name:', name=>{if(name){ch.name=name;renderChannels();}})},
      {label:'Delete', action:()=>{channels=channels.filter(c=>c.id!==channelId); delete messages[channelId]; renderChannels(); renderMessages();}}
    );
  }

  showContextMenu(items, e.pageX, e.pageY);
}

function userRightClick(e, username) {
  e.preventDefault();

  let items = [
    {label:'DM', action:()=>createDM(username)}
  ];

  if (currentUser.username === 'admin') {
    items.push(
      {label:'Kick', action:()=>deleteUser(username)},
      {label:'Ban', action:()=>deleteUser(username)},
      {label:'Delete', action:()=>deleteUser(username)}
    );
  }

  showContextMenu(items, e.pageX, e.pageY);
}
</script>

</body>
</html>
